---
layout: layouts/session.html
title: Stata Session 2 | 14.33
current_page: session2
---
<h1>Stata Session 2</h1>
<p class="subtitle">Reshaping, merging, loops, and regression</p>

<!-- Growth Mindset Message -->
<div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left: 4px solid #4caf50; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 20px 0;">
  <strong style="color: #2e7d32;">Building on what you know</strong>
  <p style="margin: 8px 0 0; color: #1b5e20;">
    Today's topics build directly on Session 1. Reshaping and merging are how you transform data into the format you need. Loops are just a way to avoid copy-paste. Regression commands might look intimidating, but they're just functions that take variables as inputs. If you understood <code>summarize</code> last week, you can understand <code>regress</code> today.
  </p>
</div>

<div class="learning-objectives">
  <h4>What You'll Learn</h4>
  <ul>
    <li>How to reshape data between "wide" and "long" formats</li>
    <li>How to merge multiple datasets together</li>
    <li>Using loops to avoid repetitive code</li>
    <li>Working with locals and temporary files</li>
    <li>Running OLS, fixed effects, and IV regressions</li>
  </ul>
</div>

<div style="background: #f8f9fa; border: 1px solid var(--border); border-radius: 8px; padding: 16px 20px; margin: 20px 0;">
  <h4 style="margin: 0 0 12px; font-size: 0.95rem;">Download Complete Scripts</h4>
  <p style="margin: 0 0 12px; font-size: 0.9rem; color: #666;">Run the full session code in your preferred language:</p>
  <div style="display: flex; gap: 12px; flex-wrap: wrap;">
    <a href="../scripts/session2/session2.do" download style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: #1a5f8a; color: white; border-radius: 6px; text-decoration: none; font-size: 0.85rem; font-weight: 500;">
      <span>Stata</span> <span style="opacity: 0.7;">.do</span>
    </a>
    <a href="../scripts/session2/session2.R" download style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: #276dc3; color: white; border-radius: 6px; text-decoration: none; font-size: 0.85rem; font-weight: 500;">
      <span>R</span> <span style="opacity: 0.7;">.R</span>
    </a>
    <a href="../scripts/session2/session2.py" download style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: #3776ab; color: white; border-radius: 6px; text-decoration: none; font-size: 0.85rem; font-weight: 500;">
      <span>Python</span> <span style="opacity: 0.7;">.py</span>
    </a>
  </div>
</div>

<div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: white; padding: 20px 24px; border-radius: 12px; margin: 24px 0;">
  <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
    <div>
      <strong>Live Quiz</strong> ‚Äî Test your understanding during class
    </div>
    <a href="../../poll/student.html" target="_blank" style="background: #4ade80; color: #0f0f0f; padding: 8px 20px; border-radius: 6px; text-decoration: none; font-weight: 600;">Take Quiz</a>
  </div>
</div>

<!-- ==================== RESHAPING DATA ==================== -->
<section id="reshaping" class="tutorial-section">
  <h2>Reshaping Data</h2>

  <p>Data comes in two basic shapes: <strong>wide</strong> and <strong>long</strong>. Understanding the difference‚Äîand knowing how to convert between them‚Äîis essential for data analysis.</p>

  <h3>Wide vs. Long Format</h3>

  <p>Consider GDP data for three countries over three years:</p>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
    <div>
      <p style="font-weight: 600; margin-bottom: 8px; color: #1976d2;">Wide Format</p>
      <p style="font-size: 0.9rem; margin-bottom: 8px;">Each row is a country. Years are <em>columns</em>.</p>
      <table style="font-size: 0.85rem; border-collapse: collapse; width: 100%;">
        <thead>
          <tr style="background: #e9ecef;">
            <th style="padding: 6px; border: 1px solid #dee2e6;">country</th>
            <th style="padding: 6px; border: 1px solid #dee2e6;">gdp2018</th>
            <th style="padding: 6px; border: 1px solid #dee2e6;">gdp2019</th>
            <th style="padding: 6px; border: 1px solid #dee2e6;">gdp2020</th>
          </tr>
        </thead>
        <tbody>
          <tr><td style="padding: 6px; border: 1px solid #dee2e6;">USA</td><td style="padding: 6px; border: 1px solid #dee2e6;">20.5</td><td style="padding: 6px; border: 1px solid #dee2e6;">21.4</td><td style="padding: 6px; border: 1px solid #dee2e6;">20.9</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #dee2e6;">China</td><td style="padding: 6px; border: 1px solid #dee2e6;">13.9</td><td style="padding: 6px; border: 1px solid #dee2e6;">14.3</td><td style="padding: 6px; border: 1px solid #dee2e6;">14.7</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #dee2e6;">Japan</td><td style="padding: 6px; border: 1px solid #dee2e6;">5.0</td><td style="padding: 6px; border: 1px solid #dee2e6;">5.1</td><td style="padding: 6px; border: 1px solid #dee2e6;">5.0</td></tr>
        </tbody>
      </table>
      <p style="font-size: 0.85rem; margin-top: 8px;"><strong>3 rows</strong> (one per country)</p>
    </div>
    <div>
      <p style="font-weight: 600; margin-bottom: 8px; color: #388e3c;">Long Format</p>
      <p style="font-size: 0.9rem; margin-bottom: 8px;">Each row is a country-year. Year is a <em>variable</em>.</p>
      <table style="font-size: 0.85rem; border-collapse: collapse; width: 100%;">
        <thead>
          <tr style="background: #e9ecef;">
            <th style="padding: 6px; border: 1px solid #dee2e6;">country</th>
            <th style="padding: 6px; border: 1px solid #dee2e6;">year</th>
            <th style="padding: 6px; border: 1px solid #dee2e6;">gdp</th>
          </tr>
        </thead>
        <tbody>
          <tr><td style="padding: 6px; border: 1px solid #dee2e6;">USA</td><td style="padding: 6px; border: 1px solid #dee2e6;">2018</td><td style="padding: 6px; border: 1px solid #dee2e6;">20.5</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #dee2e6;">USA</td><td style="padding: 6px; border: 1px solid #dee2e6;">2019</td><td style="padding: 6px; border: 1px solid #dee2e6;">21.4</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #dee2e6;">USA</td><td style="padding: 6px; border: 1px solid #dee2e6;">2020</td><td style="padding: 6px; border: 1px solid #dee2e6;">20.9</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #dee2e6;">China</td><td style="padding: 6px; border: 1px solid #dee2e6;">2018</td><td style="padding: 6px; border: 1px solid #dee2e6;">13.9</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #dee2e6;">...</td><td style="padding: 6px; border: 1px solid #dee2e6;">...</td><td style="padding: 6px; border: 1px solid #dee2e6;">...</td></tr>
        </tbody>
      </table>
      <p style="font-size: 0.85rem; margin-top: 8px;"><strong>9 rows</strong> (one per country-year)</p>
    </div>
  </div>

  <div class="key-principle">
    <h4>When to Use Each Format</h4>
    <ul>
      <li><strong>Long format:</strong> Usually needed for regression, plotting, and most analysis. This is the "tidy" format.</li>
      <li><strong>Wide format:</strong> Sometimes easier for data entry or viewing, but rarely what you want for analysis.</li>
    </ul>
    <p><strong>Rule of thumb:</strong> If you're unsure, you probably want long format.</p>
  </div>

  <h3 id="reshape-wide-to-long">Reshaping: Wide ‚Üí Long</h3>

  <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px 20px; margin: 20px 0; border-radius: 0 8px 8px 0;">
    <strong>ü§î Predict:</strong> If you have wide data with 3 countries and columns <code>gdp2018, gdp2019, gdp2020</code>, how many rows will you have after reshaping to long?
  </div>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Start with wide data: country, gdp2018, gdp2019, gdp2020

* Reshape wide to long
* Syntax: reshape long [stub], i([id var]) j([new time var])
reshape long gdp, i(country) j(year)

* What this does:
*   - i(country): country is the ID variable (stays as is)
*   - j(year): creates a new variable "year" from the suffixes
*   - gdp: the stub - looks for gdp2018, gdp2019, etc.

* Check the result
list, clean</code></pre>
    <pre class="code-content r"><code class="language-r"># Start with wide data: country, gdp2018, gdp2019, gdp2020

# Reshape wide to long using pivot_longer
df_long <- df %>%
  pivot_longer(
    cols = starts_with("gdp"),     # Columns to reshape
    names_to = "year",             # New column for the names
    names_prefix = "gdp",          # Remove "gdp" prefix
    values_to = "gdp"              # New column for the values
  ) %>%
  mutate(year = as.integer(year))  # Convert year to integer

# Check the result
print(df_long)</code></pre>
    <pre class="code-content python"><code class="language-python"># Start with wide data: country, gdp2018, gdp2019, gdp2020

# Reshape wide to long using melt
df_long = df.melt(
    id_vars=['country'],           # Keep these as is
    var_name='year',               # Name for the variable column
    value_name='gdp'               # Name for the value column
)

# Clean up: extract year from "gdp2018" -> 2018
df_long['year'] = df_long['year'].str.replace('gdp', '').astype(int)

# Check the result
print(df_long)</code></pre>
  </div>

  <h3 id="reshape-long-to-wide">Reshaping: Long ‚Üí Wide</h3>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Start with long data: country, year, gdp

* Reshape long to wide
reshape wide gdp, i(country) j(year)

* This creates: country, gdp2018, gdp2019, gdp2020</code></pre>
    <pre class="code-content r"><code class="language-r"># Start with long data: country, year, gdp

# Reshape long to wide using pivot_wider
df_wide <- df_long %>%
  pivot_wider(
    names_from = year,
    values_from = gdp,
    names_prefix = "gdp"
  )

# This creates: country, gdp2018, gdp2019, gdp2020</code></pre>
    <pre class="code-content python"><code class="language-python"># Start with long data: country, year, gdp

# Reshape long to wide using pivot
df_wide = df_long.pivot(
    index='country',
    columns='year',
    values='gdp'
).reset_index()

# This creates: country, 2018, 2019, 2020
# Rename columns if you want the "gdp" prefix
df_wide.columns = ['country'] + [f'gdp{y}' for y in df_wide.columns[1:]]</code></pre>
  </div>
</section>

<!-- ==================== MERGING DATA ==================== -->
<section id="merging" class="tutorial-section">
  <h2>Merging Data</h2>

  <p>Real research almost always requires combining data from multiple sources. This is called <strong>merging</strong> (Stata) or <strong>joining</strong> (R/Python).</p>

  <h3>The Concept</h3>

  <p>Imagine you have:</p>
  <ul>
    <li><strong>Dataset A:</strong> People's ages (id, age)</li>
    <li><strong>Dataset B:</strong> People's incomes (id, income)</li>
  </ul>

  <p>You want to combine them into one dataset with id, age, AND income. The <strong>key</strong> (the variable that links them) is <code>id</code>.</p>

  <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px 20px; margin: 20px 0; border-radius: 0 8px 8px 0;">
    <strong>ü§î Predict:</strong> What happens if person 5 is in Dataset A but not in Dataset B? What should their income be in the merged data?
  </div>

  <h3>Merge Types</h3>

  <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
    <thead>
      <tr style="background: #e9ecef;">
        <th style="padding: 10px; border: 1px solid #dee2e6;">Type</th>
        <th style="padding: 10px; border: 1px solid #dee2e6;">Stata</th>
        <th style="padding: 10px; border: 1px solid #dee2e6;">R</th>
        <th style="padding: 10px; border: 1px solid #dee2e6;">When to Use</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>1:1</strong></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><code>merge 1:1</code></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><code>inner_join</code></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;">Each row in A matches exactly one row in B</td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>m:1</strong></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><code>merge m:1</code></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><code>left_join</code></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;">Many rows in A match one row in B (e.g., people to states)</td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>1:m</strong></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><code>merge 1:m</code></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><code>right_join</code></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;">One row in A matches many rows in B</td>
      </tr>
      <tr style="background: #ffebee;">
        <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>m:m</strong></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><code>merge m:m</code></td>
        <td style="padding: 10px; border: 1px solid #dee2e6;">‚Äî</td>
        <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>Almost never correct!</strong> Usually indicates a problem.</td>
      </tr>
    </tbody>
  </table>

  <h3 id="merge-example">Merging: Step by Step</h3>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Example: Merge person data with state-level unemployment

* Step 1: Load the "master" dataset (person-level)
use person_data.dta, clear
count  // Check: 10,000 people

* Step 2: Merge with "using" dataset (state-level)
* m:1 because many people live in each state
merge m:1 state using state_unemployment.dta

* Step 3: CHECK THE MERGE RESULTS
tab _merge

* _merge values:
*   1 = in master only (person with no matching state)
*   2 = in using only (state with no people)
*   3 = matched (what you want)

* Step 4: Decide what to do with unmatched
* Usually keep only matched:
keep if _merge == 3
drop _merge</code></pre>
    <pre class="code-content r"><code class="language-r"># Example: Merge person data with state-level unemployment

# Step 1: Load datasets
person_data <- read_csv("person_data.csv")
state_data <- read_csv("state_unemployment.csv")

# Check dimensions
nrow(person_data)  # 10,000 people
nrow(state_data)   # 50 states

# Step 2: Merge
# left_join keeps all people, adds state data where matched
merged <- person_data %>%
  left_join(state_data, by = "state")

# Step 3: Check for unmatched
sum(is.na(merged$unemployment))  # How many have missing state data?

# Step 4: Remove unmatched if needed
merged <- merged %>% filter(!is.na(unemployment))</code></pre>
    <pre class="code-content python"><code class="language-python"># Example: Merge person data with state-level unemployment

# Step 1: Load datasets
person_data = pd.read_csv("person_data.csv")
state_data = pd.read_csv("state_unemployment.csv")

# Check dimensions
len(person_data)  # 10,000 people
len(state_data)   # 50 states

# Step 2: Merge
# merge with indicator to check matching
merged = person_data.merge(
    state_data,
    on='state',
    how='left',
    indicator=True
)

# Step 3: Check for unmatched
print(merged['_merge'].value_counts())

# Step 4: Remove unmatched if needed
merged = merged[merged['_merge'] == 'both']
merged = merged.drop(columns=['_merge'])</code></pre>
  </div>

  <div style="background: #ffebee; border-left: 4px solid #f44336; padding: 16px 20px; margin: 20px 0; border-radius: 0 8px 8px 0;">
    <strong>‚ö†Ô∏è Always Check Your Merge!</strong>
    <ul style="margin: 8px 0 0 0;">
      <li>Did the number of observations change unexpectedly?</li>
      <li>How many observations matched vs. didn't match?</li>
      <li>Do unmatched observations make sense (e.g., states with no people)?</li>
    </ul>
    <p style="margin-top: 8px;">Most merge bugs are silent‚Äîyour code runs but gives wrong answers. Checking <code>_merge</code> is how you catch them.</p>
  </div>
</section>

<!-- ==================== LOOPS AND LOCALS ==================== -->
<section id="loops" class="tutorial-section">
  <h2>Loops and Locals</h2>

  <p>Loops let you write code once and run it many times. If you ever find yourself copy-pasting code and just changing one number, you should use a loop instead.</p>

  <h3 id="forvalues">The <code>forvalues</code> Loop</h3>

  <!-- Real-world motivation -->
  <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üéØ Real scenario:</strong> You're creating a categorical variable for number of children (0, 1, 2, 3+). You could write 4 separate lines... or use a loop.
  </div>

  <p><strong>Without a loop (bad):</strong></p>
  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* This is repetitive and error-prone
replace kids_cat = 0 if nchild == 0
replace kids_cat = 1 if nchild == 1
replace kids_cat = 2 if nchild == 2
replace kids_cat = 3 if nchild == 3</code></pre>
    <pre class="code-content r"><code class="language-r"># This is repetitive and error-prone
df$kids_cat[df$nchild == 0] <- 0
df$kids_cat[df$nchild == 1] <- 1
df$kids_cat[df$nchild == 2] <- 2
df$kids_cat[df$nchild == 3] <- 3</code></pre>
    <pre class="code-content python"><code class="language-python"># This is repetitive and error-prone
df.loc[df['nchild'] == 0, 'kids_cat'] = 0
df.loc[df['nchild'] == 1, 'kids_cat'] = 1
df.loc[df['nchild'] == 2, 'kids_cat'] = 2
df.loc[df['nchild'] == 3, 'kids_cat'] = 3</code></pre>
  </div>

  <p><strong>With a loop (good):</strong></p>
  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Much cleaner!
forvalues i = 0/3 {
    replace kids_cat = `i' if nchild == `i'
}</code></pre>
    <pre class="code-content r"><code class="language-r"># Much cleaner!
for (i in 0:3) {
    df$kids_cat[df$nchild == i] <- i
}</code></pre>
    <pre class="code-content python"><code class="language-python"># Much cleaner!
for i in range(4):
    df.loc[df['nchild'] == i, 'kids_cat'] = i</code></pre>
  </div>

  <!-- Step-by-step explanation -->
  <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üí° What happens when this runs (Stata):</strong>
    <ol style="margin: 10px 0 0 0; padding-left: 20px;">
      <li>First iteration: <code>i</code> = 0 ‚Üí runs <code>replace kids_cat = 0 if nchild == 0</code></li>
      <li>Second iteration: <code>i</code> = 1 ‚Üí runs <code>replace kids_cat = 1 if nchild == 1</code></li>
      <li>Third iteration: <code>i</code> = 2 ‚Üí runs <code>replace kids_cat = 2 if nchild == 2</code></li>
      <li>Fourth iteration: <code>i</code> = 3 ‚Üí runs <code>replace kids_cat = 3 if nchild == 3</code></li>
    </ol>
    <p style="margin: 10px 0 0;">The backticks <code>`i'</code> get replaced with the current value of the loop variable.</p>
  </div>

  <div class="key-principle">
    <h4>How to Build a Loop</h4>
    <ol>
      <li>Write the code for one value first (e.g., the <code>i = 0</code> case)</li>
      <li>Make sure it works</li>
      <li>Then wrap it in a loop, replacing the number with the loop variable</li>
    </ol>
    <p>This way, if something breaks, you know whether it's the code or the loop.</p>
  </div>

  <h3 id="foreach">Loop Variations</h3>

  <!-- Predict box -->
  <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>ü§î Before running this code, predict:</strong> What will <code>forvalues i = 5(5)100</code> print? (Hint: the middle number is the step size.)
  </div>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Count from 0 to 3
forvalues i = 0/3 {
    display `i'
}

* Count by 5s from 5 to 100
forvalues i = 5(5)100 {
    display `i'
}

* Loop over a list of values (not just numbers)
foreach v in income age education {
    summarize `v'
}</code></pre>
    <pre class="code-content r"><code class="language-r"># Count from 0 to 3
for (i in 0:3) {
    print(i)
}

# Count by 5s from 5 to 100
for (i in seq(5, 100, by = 5)) {
    print(i)
}

# Loop over a list of values (not just numbers)
for (v in c("income", "age", "education")) {
    print(summary(df[[v]]))
}</code></pre>
    <pre class="code-content python"><code class="language-python"># Count from 0 to 3
for i in range(4):
    print(i)

# Count by 5s from 5 to 100
for i in range(5, 101, 5):
    print(i)

# Loop over a list of values (not just numbers)
for v in ['income', 'age', 'education']:
    print(df[v].describe())</code></pre>
  </div>

  <!-- Answer to predict -->
  <details style="margin: 16px 0; padding: 12px 16px; background: #f5f5f5; border-radius: 8px; cursor: pointer;">
    <summary style="font-weight: 600; color: var(--primary);">Answer: What does <code>5(5)100</code> print?</summary>
    <p style="margin: 12px 0 0;">It prints: 5, 10, 15, 20, 25, ... 95, 100. The syntax is <code>start(step)end</code>, so this starts at 5, goes up by 5 each time, and stops at 100.</p>
  </details>

  <!-- foreach explanation -->
  <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üí° <code>foreach</code> vs <code>forvalues</code>:</strong>
    <ul style="margin: 10px 0 0;">
      <li><code>forvalues</code> = loop over numbers (0, 1, 2, 3 or 5, 10, 15...)</li>
      <li><code>foreach</code> = loop over a list of anything (variable names, file names, strings)</li>
    </ul>
  </div>

  <!-- Quiz: Loops -->
  <div class="section-quiz" style="background: #f8f9fa; border: 2px solid var(--primary); border-radius: 12px; padding: 20px; margin: 24px 0;">
    <h4 style="color: var(--primary); margin-top: 0;">Quick Check: Loops</h4>
    <p><strong>Question:</strong> In Stata, what values will <code>forvalues i = 0/3</code> iterate through?</p>
    <div style="display: flex; gap: 12px; flex-wrap: wrap; margin: 12px 0;">
      <button onclick="checkAnswer(this, true)" style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer;">0, 1, 2, 3</button>
      <button onclick="checkAnswer(this, false)" style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer;">1, 2, 3</button>
      <button onclick="checkAnswer(this, false)" style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer;">0, 1, 2</button>
      <button onclick="checkAnswer(this, false)" style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer;">0, 3</button>
    </div>
    <p class="quiz-feedback" style="display: none; margin-top: 12px; padding: 10px; border-radius: 6px;"></p>
  </div>

  <h3 id="locals">Understanding Locals</h3>

  <p>A <strong>local</strong> (in Stata) or <strong>variable</strong> (in R/Python) stores a value temporarily. Think of it as giving a nickname to something you'll use repeatedly.</p>

  <!-- Why locals matter -->
  <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üéØ Why use locals?</strong>
    <ul style="margin: 10px 0 0;">
      <li><strong>Change once, update everywhere:</strong> If you store your control variables in a local, you only need to change one line to add/remove a control</li>
      <li><strong>Store results:</strong> Save a coefficient from one regression to use in another calculation</li>
      <li><strong>Make code readable:</strong> <code>`controls'</code> is clearer than a long list of variables</li>
    </ul>
  </div>

  <p>In Stata, you create a local without quotes but use it wrapped in backtick and apostrophe: <code>`name'</code></p>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Create a local
local myvar = 7

* Use the local
display `myvar'

* Locals are useful for storing lists
local controls "age education income"
reg wage `controls'

* Or for storing results
reg wage education
local coef = _b[education]
display "The coefficient was `coef'"</code></pre>
    <pre class="code-content r"><code class="language-r"># Create a variable
myvar <- 7

# Use the variable
print(myvar)

# Variables are useful for storing lists
controls <- c("age", "education", "income")
model <- lm(wage ~ age + education + income, data = df)

# Or for storing results
model <- lm(wage ~ education, data = df)
coef_val <- coef(model)["education"]
print(paste("The coefficient was", coef_val))</code></pre>
    <pre class="code-content python"><code class="language-python"># Create a variable
myvar = 7

# Use the variable
print(myvar)

# Variables are useful for storing lists
controls = ['age', 'education', 'income']
import statsmodels.formula.api as smf
model = smf.ols('wage ~ age + education + income', data=df).fit()

# Or for storing results
model = smf.ols('wage ~ education', data=df).fit()
coef_val = model.params['education']
print(f"The coefficient was {coef_val}")</code></pre>
  </div>

  <div class="common-mistakes">
    <h4>Stata: Locals Only Last One "Run"</h4>
    <p>If you highlight <code>local x = 5</code> and run it, then separately highlight <code>display `x'</code> and run it, Stata will have forgotten <code>x</code>. You must run both lines together. (R and Python don't have this issue.)</p>
  </div>

  <h3 id="preserve">Preserve and Restore</h3>

  <p>Sometimes you want to temporarily modify data, do something, then go back to the original:</p>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Save the current state
preserve

* Do something that changes the data
keep if state == "CA"
save california_only.dta, replace

* Go back to the full dataset
restore

* The full dataset is back!</code></pre>
    <pre class="code-content r"><code class="language-r"># Make a copy before modifying
df_backup <- df

# Do something that changes the data
df_ca <- df[df$state == "CA", ]
saveRDS(df_ca, "california_only.rds")

# The original is still in df_backup
# (or just use df_ca and keep df unchanged)</code></pre>
    <pre class="code-content python"><code class="language-python"># Make a copy before modifying
df_backup = df.copy()

# Do something that changes the data
df_ca = df[df['state'] == 'CA']
df_ca.to_csv('california_only.csv', index=False)

# The original is still in df_backup
# (or just filter without reassigning to keep df unchanged)</code></pre>
  </div>
</section>

<!-- ==================== REGRESSION ==================== -->
<section id="regression" class="tutorial-section">
  <h2>Regression</h2>

  <p>This section covers the main regression commands you'll use in applied economics research. The syntax is similar across languages: you specify a dependent variable (Y), independent variables (X), and options like standard error types.</p>

  <h3 id="ols">Basic OLS Regression</h3>

  <!-- Anatomy of a regression command -->
  <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 16px 0; font-family: monospace;">
    <div style="color: #666; margin-bottom: 8px;">Stata syntax:</div>
    <div style="font-size: 1.1em;">
      <span style="color: #750014; font-weight: bold;">reg</span>
      <span style="color: #1565c0;">wage</span>
      <span style="color: #2e7d32;">education age experience</span>,
      <span style="color: #7b1fa2;">robust</span>
    </div>
    <div style="display: flex; gap: 20px; margin-top: 12px; font-size: 0.85em; flex-wrap: wrap;">
      <span><span style="color: #750014;">‚ñ†</span> command</span>
      <span><span style="color: #1565c0;">‚ñ†</span> Y (dependent)</span>
      <span><span style="color: #2e7d32;">‚ñ†</span> X (independent)</span>
      <span><span style="color: #7b1fa2;">‚ñ†</span> options</span>
    </div>
  </div>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Simple regression
reg wage education

* Add control variables
reg wage education age experience

* Heteroskedasticity-robust standard errors
reg wage education age experience, robust

* Cluster standard errors by state
reg wage education age experience, cluster(state)</code></pre>
    <pre class="code-content r"><code class="language-r"># Simple regression
model <- lm(wage ~ education, data = df)
summary(model)

# Add control variables
model <- lm(wage ~ education + age + experience, data = df)

# Heteroskedasticity-robust standard errors
pacman::p_load(sandwich, lmtest)
coeftest(model, vcov = vcovHC(model, type = "HC1"))

# Cluster standard errors by state
pacman::p_load(clubSandwich)
coef_test(model, vcov = vcovCR(model, cluster = df$state, type = "CR0"))</code></pre>
    <pre class="code-content python"><code class="language-python">import statsmodels.formula.api as smf

# Simple regression
model = smf.ols('wage ~ education', data=df).fit()
print(model.summary())

# Add control variables
model = smf.ols('wage ~ education + age + experience', data=df).fit()

# Heteroskedasticity-robust standard errors
model_robust = smf.ols('wage ~ education + age + experience', data=df).fit(
    cov_type='HC1'
)

# Cluster standard errors by state
model_cluster = smf.ols('wage ~ education + age + experience', data=df).fit(
    cov_type='cluster', cov_kwds={'groups': df['state']}
)</code></pre>
  </div>

  <!-- Standard errors explanation -->
  <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üí° Which standard errors should I use?</strong>
    <table style="width: 100%; margin-top: 12px; border-collapse: collapse; font-size: 0.9em;">
      <tr style="background: #bbdefb;">
        <th style="padding: 8px; text-align: left; border: 1px solid #90caf9;">Situation</th>
        <th style="padding: 8px; text-align: left; border: 1px solid #90caf9;">Standard Errors</th>
        <th style="padding: 8px; text-align: left; border: 1px solid #90caf9;">Stata Option</th>
      </tr>
      <tr>
        <td style="padding: 8px; border: 1px solid #e3f2fd;">Cross-sectional data, simple models</td>
        <td style="padding: 8px; border: 1px solid #e3f2fd;">Robust (HC1)</td>
        <td style="padding: 8px; border: 1px solid #e3f2fd;"><code>, robust</code></td>
      </tr>
      <tr>
        <td style="padding: 8px; border: 1px solid #e3f2fd;">Panel data (observations grouped by unit)</td>
        <td style="padding: 8px; border: 1px solid #e3f2fd;">Clustered by unit</td>
        <td style="padding: 8px; border: 1px solid #e3f2fd;"><code>, cluster(state)</code></td>
      </tr>
      <tr>
        <td style="padding: 8px; border: 1px solid #e3f2fd;">Workers grouped by firm</td>
        <td style="padding: 8px; border: 1px solid #e3f2fd;">Clustered by firm</td>
        <td style="padding: 8px; border: 1px solid #e3f2fd;"><code>, cluster(firm)</code></td>
      </tr>
      <tr>
        <td style="padding: 8px; border: 1px solid #e3f2fd;">DiD with state-level treatment</td>
        <td style="padding: 8px; border: 1px solid #e3f2fd;">Clustered by state</td>
        <td style="padding: 8px; border: 1px solid #e3f2fd;"><code>, cluster(state)</code></td>
      </tr>
    </table>
    <p style="margin: 12px 0 0; font-size: 0.9em;"><strong>Rule of thumb:</strong> Cluster at the level of treatment assignment or the level where errors might be correlated.</p>
  </div>

  <h3 id="interactions">Interactions</h3>

  <!-- Why interactions -->
  <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üéØ When to use interactions:</strong> When you think the effect of X on Y <em>depends on</em> another variable.
    <p style="margin: 10px 0 0;"><em>Example:</em> Does the return to education differ by gender? Add <code>education##gender</code> to test whether the education coefficient is different for men vs. women.</p>
  </div>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* # adds just the interaction
reg wage education gender#married

* ## adds the interaction AND main effects
reg wage education gender##married

* For continuous variables, use c. prefix
reg wage c.education##c.experience</code></pre>
    <pre class="code-content r"><code class="language-r"># : adds just the interaction
model <- lm(wage ~ education + gender:married, data = df)

# * adds the interaction AND main effects
model <- lm(wage ~ education + gender*married, data = df)

# For continuous variables
model <- lm(wage ~ education * experience, data = df)</code></pre>
    <pre class="code-content python"><code class="language-python"># : adds just the interaction
model = smf.ols('wage ~ education + gender:married', data=df).fit()

# * adds the interaction AND main effects
model = smf.ols('wage ~ education + gender*married', data=df).fit()

# For continuous variables
model = smf.ols('wage ~ education * experience', data=df).fit()</code></pre>
  </div>

  <!-- Interpreting interactions -->
  <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üí° Interpreting <code>education##female</code> coefficients:</strong>
    <ul style="margin: 10px 0 0;">
      <li><code>education</code> = effect of education for males (the reference group)</li>
      <li><code>1.female</code> = wage gap between females and males (at 0 years of education)</li>
      <li><code>1.female#c.education</code> = how much more/less females gain from each year of education compared to males</li>
    </ul>
    <p style="margin: 10px 0 0;"><strong>Total effect of education for females</strong> = <code>education</code> + <code>1.female#c.education</code></p>
  </div>

  <!-- Quiz: Regression -->
  <div class="section-quiz" style="background: #f8f9fa; border: 2px solid var(--primary); border-radius: 12px; padding: 20px; margin: 24px 0;">
    <h4 style="color: var(--primary); margin-top: 0;">Quick Check: Standard Errors</h4>
    <p><strong>Question:</strong> You're analyzing wage data where workers are grouped by firm. What type of standard errors should you use?</p>
    <div style="display: flex; gap: 12px; flex-wrap: wrap; margin: 12px 0;">
      <button onclick="checkAnswer(this, false)" style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer;">Default (homoskedastic)</button>
      <button onclick="checkAnswer(this, false)" style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer;">Robust (HC1)</button>
      <button onclick="checkAnswer(this, true)" style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer;">Clustered by firm</button>
    </div>
    <p class="quiz-feedback" style="display: none; margin-top: 12px; padding: 10px; border-radius: 6px;"></p>
  </div>

  <h3 id="fixed-effects">Fixed Effects</h3>

  <!-- Why fixed effects -->
  <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üéØ What fixed effects do:</strong> Control for all time-invariant characteristics of a group.
    <p style="margin: 10px 0 0;">
      <em>State fixed effects</em> control for everything about a state that doesn't change over time (geography, culture, history).<br>
      <em>Year fixed effects</em> control for everything that affects all states equally in a given year (recessions, federal policy).
    </p>
    <p style="margin: 10px 0 0;"><strong>Two-way fixed effects (TWFE)</strong> = state FE + year FE. This is the workhorse of diff-in-diff.</p>
  </div>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Using absorb() to add fixed effects
* (doesn't show the FE coefficients, which is usually what you want)
reg wage education age, absorb(state)

* For MANY fixed effects, use reghdfe (faster)
ssc install reghdfe  // run once to install
ssc install ftools   // dependency

reghdfe wage education age, absorb(state year)

* Two-way fixed effects with clustering
reghdfe wage education, absorb(state year) cluster(state)</code></pre>
    <pre class="code-content r"><code class="language-r"># Using fixest package (fastest option)
pacman::p_load(fixest)

# One-way fixed effects
model <- feols(wage ~ education + age | state, data = df)

# Two-way fixed effects
model <- feols(wage ~ education + age | state + year, data = df)

# With clustered standard errors
model <- feols(wage ~ education | state + year,
               cluster = ~state, data = df)</code></pre>
    <pre class="code-content python"><code class="language-python"># Using pyfixest (similar to R's fixest)
import pyfixest as pf

# One-way fixed effects
model = pf.feols('wage ~ education + age | state', data=df)

# Two-way fixed effects
model = pf.feols('wage ~ education + age | state + year', data=df)

# With clustered standard errors
model = pf.feols('wage ~ education | state + year',
                 vcov={'CRV1': 'state'}, data=df)</code></pre>
  </div>

  <div class="key-principle">
    <h4>When to Use High-Dimensional Fixed Effects</h4>
    <p>Use <code>reghdfe</code> (Stata), <code>fixest</code> (R), or <code>pyfixest</code> (Python) whenever you have many fixed effects (hundreds or thousands of groups). They're much faster than including dummy variables, and they handle multiple sets of fixed effects efficiently.</p>
  </div>

  <h3 id="iv">Instrumental Variables</h3>

  <!-- Why IV -->
  <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>üéØ When to use IV:</strong> When your key independent variable is <em>endogenous</em> (correlated with the error term).
    <p style="margin: 10px 0 0;">
      <em>Classic example:</em> Does education increase wages? Problem: unobserved ability affects both education AND wages.<br>
      <em>Solution:</em> Find an instrument (like quarter of birth) that affects education but has no direct effect on wages.
    </p>
  </div>

  <!-- IV requirements -->
  <div style="background: #ffebee; border-left: 4px solid #f44336; padding: 16px 20px; border-radius: 0 8px 8px 0; margin: 16px 0;">
    <strong>‚ö†Ô∏è A valid instrument must satisfy two conditions:</strong>
    <ol style="margin: 10px 0 0;">
      <li><strong>Relevance:</strong> The instrument affects the endogenous variable (check the first-stage F-statistic)</li>
      <li><strong>Exclusion:</strong> The instrument affects Y <em>only through</em> the endogenous variable (not directly)</li>
    </ol>
    <p style="margin: 10px 0 0;">Condition 1 is testable. Condition 2 is not‚Äîyou must argue it's plausible.</p>
  </div>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Install ivreghdfe
ssc install ivreghdfe  // run once

* IV regression syntax: (endogenous = instruments)
* Example: education is endogenous, quarter_of_birth is the instrument
ivreghdfe wage (education = quarter_of_birth) age experience

* With fixed effects
ivreghdfe wage (education = quarter_of_birth) age, absorb(state year)</code></pre>
    <pre class="code-content r"><code class="language-r"># Using fixest for IV
pacman::p_load(fixest)

# IV regression: education instrumented by quarter_of_birth
model <- feols(wage ~ age + experience |
               education ~ quarter_of_birth, data = df)

# With fixed effects
model <- feols(wage ~ age | state + year |
               education ~ quarter_of_birth, data = df)</code></pre>
    <pre class="code-content python"><code class="language-python"># Using pyfixest for IV
import pyfixest as pf

# IV regression: education instrumented by quarter_of_birth
model = pf.feols('wage ~ age + experience | education ~ quarter_of_birth',
                 data=df)

# With fixed effects
model = pf.feols('wage ~ age | state + year | education ~ quarter_of_birth',
                 data=df)</code></pre>
  </div>

  <h3 id="exporting">Exporting Results</h3>

  <div class="code-block">
    <div class="code-header">
      <div class="code-tabs">
        <button class="code-tab active" data-lang="stata">Stata</button>
        <button class="code-tab" data-lang="r">R</button>
        <button class="code-tab" data-lang="python">Python</button>
      </div>
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
    </div>
    <pre class="code-content stata active"><code class="language-stata">* Install estout for publication tables
ssc install estout

* Store results
eststo clear
eststo m1: reg wage education, robust
eststo m2: reg wage education age, robust
eststo m3: reg wage education age experience, robust

* Create a nice table
esttab m1 m2 m3, se r2 label ///
    title("Wage Regressions") ///
    mtitles("(1)" "(2)" "(3)")

* Export to LaTeX
esttab m1 m2 m3 using "tables/wage_regs.tex", replace ///
    se r2 label booktabs</code></pre>
    <pre class="code-content r"><code class="language-r"># Using modelsummary
pacman::p_load(modelsummary)

# Run regressions
m1 <- lm(wage ~ education, data = df)
m2 <- lm(wage ~ education + age, data = df)
m3 <- lm(wage ~ education + age + experience, data = df)

# Create table
modelsummary(list("(1)" = m1, "(2)" = m2, "(3)" = m3),
             stars = TRUE,
             gof_omit = "IC|Log")

# Export to LaTeX
modelsummary(list(m1, m2, m3),
             output = "tables/wage_regs.tex")</code></pre>
    <pre class="code-content python"><code class="language-python"># Using stargazer-style output with pyfixest
import pyfixest as pf

# Run regressions
m1 = pf.feols('wage ~ education', data=df, vcov='HC1')
m2 = pf.feols('wage ~ education + age', data=df, vcov='HC1')
m3 = pf.feols('wage ~ education + age + experience', data=df, vcov='HC1')

# Create table
pf.etable([m1, m2, m3])

# Export to LaTeX
pf.etable([m1, m2, m3], type='tex', file='tables/wage_regs.tex')</code></pre>
  </div>
</section>

<!-- ==================== PRACTICE ==================== -->
<section id="practice" class="tutorial-section">
  <h2>Practice Exercise</h2>

  <p>Try this exercise to cement what you've learned. Work through it step by step‚Äîdon't just read the answer.</p>

  <div style="background: #f5f5f5; padding: 20px; border-radius: 12px; margin: 16px 0;">
    <h4 style="margin-top: 0;">Exercise: Wage Regression with Loops</h4>
    <p>You have wage data with variables <code>wage</code>, <code>education</code>, <code>age</code>, <code>experience</code>, and <code>state</code>. Write code to:</p>
    <ol>
      <li>Create a local/variable called <code>controls</code> containing <code>age experience</code></li>
      <li>Run a regression of <code>wage</code> on <code>education</code> plus the controls, with robust standard errors</li>
      <li>Run the same regression with state fixed effects and clustered standard errors</li>
      <li>Use a loop to summarize all three independent variables (<code>education</code>, <code>age</code>, <code>experience</code>)</li>
    </ol>
  </div>

  <details style="margin: 16px 0; padding: 12px 16px; background: #e8f5e9; border-radius: 8px; cursor: pointer;">
    <summary style="font-weight: 600; color: #2e7d32;">Click to see solution (Stata)</summary>
    <pre style="margin: 12px 0 0; background: #1b5e20; color: #c8e6c9; padding: 16px; border-radius: 6px; overflow-x: auto;"><code>* 1. Create local with controls
local controls "age experience"

* 2. OLS with robust SEs
reg wage education `controls', robust

* 3. With state FE and clustered SEs
reghdfe wage education `controls', absorb(state) cluster(state)

* 4. Summarize each variable in a loop
foreach v in education age experience {
    summarize `v'
}</code></pre>
  </details>

  <details style="margin: 16px 0; padding: 12px 16px; background: #e8f5e9; border-radius: 8px; cursor: pointer;">
    <summary style="font-weight: 600; color: #2e7d32;">Click to see solution (R)</summary>
    <pre style="margin: 12px 0 0; background: #1b5e20; color: #c8e6c9; padding: 16px; border-radius: 6px; overflow-x: auto;"><code>pacman::p_load(fixest, lmtest, sandwich)

# 1. Vector of controls
controls <- c("age", "experience")

# 2. OLS with robust SEs
m1 <- lm(wage ~ education + age + experience, data = df)
coeftest(m1, vcov = vcovHC(m1, type = "HC1"))

# 3. With state FE and clustered SEs
m2 <- feols(wage ~ education + age + experience | state,
            cluster = ~state, data = df)

# 4. Summarize each variable in a loop
for (v in c("education", "age", "experience")) {
    print(summary(df[[v]]))
}</code></pre>
  </details>
</section>

<section id="quiz" class="tutorial-section">
  <h2>Session Complete!</h2>

  <p>You've learned the essentials of loops, project organization, and regression. The key takeaways:</p>

  <div style="background: #e8f5e9; padding: 16px 20px; border-radius: 8px; margin: 16px 0;">
    <ul style="margin: 0; padding-left: 20px;">
      <li><strong>Loops</strong> eliminate copy-paste code. Write it once, run it many times.</li>
      <li><strong>Locals</strong> store values you'll reuse. Change once, update everywhere.</li>
      <li><strong>Project structure</strong> separates raw data ‚Üí cleaned data ‚Üí analysis ‚Üí output.</li>
      <li><strong>Standard errors</strong> should be clustered at the level of treatment or correlation.</li>
      <li><strong>Fixed effects</strong> control for time-invariant unobservables.</li>
    </ul>
  </div>

  <div style="background: linear-gradient(135deg, var(--primary) 0%, #c42942 100%); border-radius: 12px; padding: 24px; color: white; text-align: center;">
    <h3 style="margin: 0 0 8px;">Ready to Test Your Knowledge?</h3>
    <p style="margin: 0 0 16px; opacity: 0.9;">Answer questions about loops, locals, and regression commands</p>
    <a href="../../poll/student.html" target="_blank" style="display: inline-block; background: white; color: var(--primary); padding: 12px 32px; border-radius: 8px; text-decoration: none; font-weight: 600;">Take the Quiz</a>
  </div>

  <div style="margin-top: 40px; padding-top: 24px; border-top: 1px solid var(--border);">
    <a href="../index.html" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: var(--primary); color: #fff; border-radius: 8px; text-decoration: none; font-weight: 500;">
      &larr; Back to Tutorials
    </a>
  </div>
</section>

<script>
function checkAnswer(btn, isCorrect) {
  const buttons = btn.parentElement.querySelectorAll('button');
  const feedback = btn.parentElement.nextElementSibling;
  buttons.forEach(b => { b.disabled = true; b.style.opacity = '0.7'; });
  if (isCorrect) {
    btn.style.background = '#d4edda';
    btn.style.borderColor = '#28a745';
    btn.style.opacity = '1';
    feedback.textContent = 'Correct!';
    feedback.style.background = '#d4edda';
    feedback.style.color = '#155724';
  } else {
    btn.style.background = '#f8d7da';
    btn.style.borderColor = '#dc3545';
    btn.style.opacity = '1';
    feedback.textContent = 'Not quite. Try reviewing the section above.';
    feedback.style.background = '#f8d7da';
    feedback.style.color = '#721c24';
  }
  feedback.style.display = 'block';
}
</script>
